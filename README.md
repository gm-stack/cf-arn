# cf-arn

An attempt to document the myriad ways in which you must get the ARN of a CloudFormation resource - that differ between resources. Sometimes `!Ref` is the ARN, sometimes the name, sometimes an ID, sometimes it's not supported at all!

In fact, depending on the resource it's one or more of:

* `!Ref`
* `!GetAtt <Name>.Arn`
* `!GetAtt <Name>.ARN`
* `!GetAtt <Name>.ThingArn`
* `!GetAtt <Name>.ThingARN`
* None of the above! Time to use `!Sub` to construct it!

See also: [this bug report from 2019](https://github.com/aws-cloudformation/cloudformation-coverage-roadmap/issues/68) that calls from some improvement on the issue.

## The Report

 **The big list of services as generated by this tool can be read at [report.md](report.md).**

## Future features

* Provide some graphs/stats with a count of which combinations are the most popular.
* Parse CF attributes from the [AWS CloudFormation resource JSON file](https://d1uauaxba7bl26.cloudfront.net/latest/gzip/CloudFormationResourceSpecification.json) - although this doesn't give us what `!Ref` does - we still need to scrape the docs for that.
* Manually list how to create ARNs with `!Sub` for resources which do have them but don't have them as a parameter e.g.:
    * `AWS::EC2::Volume` -> `!Sub "arn:${AWS::Partition}:ec2:${AWS::Region}:${AWS::AccountId}:volume/${<Name>}"`
    * `AWS::EC2::Subnet` -> `!Sub "arn:${AWS::Partition}:ec2:${AWS::Region}:${AWS::AccountId}:subnet/${<Name>}"`
    * `AWS::SSM::Document` -> `!Sub "arn:${AWS::Partition}:ssm:${AWS::Region}:${AWS::AccountId}:document/${<Name>}"`
* Run this again in a while and check the new [report.md](report.md) into Git - see what's changed.

## Known bugs

* Some pages are probably being scraped incorrectly - there are possibly a few incorrect entries e.g.
    * [`AWS::Amplify::Domain`](https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-amplify-domain.html#aws-resource-amplify-domain-return-values) parses all the `UpdateStatus` enums as if they were parameters.
* Some items in the `<Thing>Arn` category have parameters listed here that are not the ARN of the object. It's hard to automatically tell which is the object itself.
    * [`AWS::EC2::Subnet`](https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-ec2-subnet.html#aws-resource-ec2-subnet-return-values) is being reported as `!GetAtt <Name>.<Thing>Arn` existing, but the parameter is `OutpostArn`. In reality this requires the `!Sub` documented above.

## "Hall of shame" for some "interesting" things discovered in the documentation.

* [`AWS::BillingConductor::BillingGroup`](https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-billingconductor-billinggroup.html) links to the documentation for the `!Ref` function but never tells you what it returns.
* [`AWS::CUR::ReportDefinition`](https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-cur-reportdefinition.html#aws-resource-cur-reportdefinition-return-values) reports that `!Ref` *returns* `{ "Ref": "ReportName" }` which would be... interesting?
* [`AWS::S3::AccessGrantsLocation`](https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-s3-accessgrantslocation.html#aws-resource-s3-accessgrantslocation-return-values) reports that `!Ref` "returns some information about the S3 data location." without specifying what information that might be.
* [`AWS::DeviceFarm::DevicePool`](https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-devicefarm-devicepool.html#aws-resource-devicefarm-devicepool-return-values) has `Ref` listed as an output only to tell you that it doesn't support it.
* [`AWS::EventSchemas::RegistryPolicy`](https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-eventschemas-registrypolicy.html#aws-resource-eventschemas-registrypolicy-return-values) in addition to providing some empty bullets in the examples, is missing a word: "When you provide the logical ID of this resource to the Ref intrinsic function, Ref the name of the registry."
* [`AWS::Connect::ApprovedOrigin`](https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-connect-approvedorigin.html#aws-resource-connect-approvedorigin-return-values) lists Ref as an output but does not specify what it returns.
* [`AWS::AppConfig::Deployment`](https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-appconfig-deployment.html#aws-resource-appconfig-deployment-return-values) does the same but for `Fn::GetAtt` as well!
* [AWS Cloudformation Open Source Documentation](https://github.com/awsdocs/aws-cloudformation-user-guide) - last but not least, AWS's own CloudFormation documentation - previously available in Markdown, open source, on Github - but they [decided to stop doing that](https://aws.amazon.com/blogs/aws/retiring-the-aws-documentation-on-github/). Would have been easier to parse than the HTML.